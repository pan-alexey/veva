{"version":3,"file":"index.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;;;;;;ACVA,iEAAe,wFAAwF,yBAAyB,gBAAgB,SAAS,OAAO,uBAAuB,OAAO,SAAS,SAAS;;;;;;;;;;;;;;ACAhN,iEAAe,GAAG,eAAe,IAAI,uCAAuC,aAAa,UAAU,iCAAiC,gBAAgB,QAAQ,MAAM,uCAAuC,IAAI,iBAAiB,yBAAyB,QAAQ,IAAI,KAAK,MAAM,uCAAuC,IAAI,kBAAkB,0BAA0B,QAAQ,IAAI,KAAK,MAAM,sCAAsC,IAAI,sBAAsB,qBAAqB,QAAQ,IAAI,KAAK,MAAM,eAAe,IAAI,+BAA+B,IAAI,2BAA2B,kBAAkB,eAAe,mBAAmB,iBAAiB,cAAc,SAAS,QAAQ,QAAQ,qBAAqB,SAAS,UAAU,KAAK,GAAG;;;;;;;;;;;;;;ACArtB,iEAAe,wEAAwE,WAAW,MAAM,iBAAiB,sCAAsC,qBAAqB,oBAAoB,SAAS,QAAQ,mBAAmB,qBAAqB,UAAU,KAAK,IAAI,SAAS,QAAQ,IAAI,MAAM,QAAQ,qBAAqB,+BAA+B,QAAQ,kBAAkB,qBAAqB,WAAW,QAAQ,IAAI,KAAK,MAAM,WAAW,0EAA0E;;;;;;;;;;;;;;ACAjhB,iEAAe,wEAAwE,WAAW,mBAAmB,8CAA8C,GAAG,kBAAkB,mBAAmB,QAAQ,OAAO,WAAW,4EAA4E;;;;;;;;;;;;;;ACAjT,iEAAe,yBAAyB;;;;;;;;;;ACA3B;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,WAAW;AACX,+BAA+B,mBAAO,CAAC,kBAAM;AAC7C,mBAAmB,mBAAO,CAAC,sCAAgB;AAC3C,wBAAwB,mBAAO,CAAC,4DAA2B;AAC3D,8BAA8B,mBAAO,CAAC,uDAAkB;AACxD,gCAAgC,mBAAO,CAAC,2DAAoB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C;AACA,oBAAoB,oBAAoB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;;;;;;;;;;AC1Da;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kCAAkC,mBAAO,CAAC,wBAAS;AACnD,uBAAuB,mBAAO,CAAC,8CAAoB;AACnD,iBAAiB,mBAAO,CAAC,kDAAU;AACnC,gCAAgC,mBAAO,CAAC,oBAAO;AAC/C,uBAAuB,mBAAO,CAAC,8CAAoB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC;AACA;AACA,eAAe,OAAO,KAAK,SAAS;AACpC;AACA;AACA,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,kBAAe;;;;;;;;;;;AC7DF;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB,GAAG,oBAAoB,GAAG,kBAAkB;AAC9D,oCAAoC,mBAAO,CAAC,4BAAW;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sCAAsC,YAAY;AAClD;AACA;AACA;AACA;AACA;AACA,sCAAsC,YAAY;AAClD;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA,kBAAkB;;;;;;;;;;;AC3DL;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,6BAA6B,mBAAO,CAAC,8CAAoB;AACzD,iBAAiB,mBAAO,CAAC,2CAAc;AACvC,kCAAkC,mBAAO,CAAC,wBAAS;AACnD,+BAA+B,mBAAO,CAAC,4DAAa;AACpD,gCAAgC,mBAAO,CAAC,oBAAO;AAC/C,wBAAwB,mBAAO,CAAC,cAAI;AACpC,uBAAuB,mBAAO,CAAC,8CAAoB;AACnD,uBAAuB,mBAAO,CAAC,8CAAoB;AACnD,sBAAsB,mBAAO,CAAC,4CAAmB;AACjD,gBAAgB,mBAAO,CAAC,gCAAa;AACrC;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACA,YAAY,uBAAuB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA,4BAA4B,+BAA+B;AAC3D;AACA;AACA,gDAAgD,KAAK,GAAG,sBAAsB;AAC9E,kCAAkC,uCAAuC;AACzE,uCAAuC,KAAK;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,6BAA6B;AACzD;AACA;AACA,8CAA8C,KAAK,GAAG,oBAAoB;AAC1E,iCAAiC,kCAAkC;AACnE,uCAAuC,KAAK;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,kCAAkC,qBAAqB;AACvD,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,kBAAe;;;;;;;;;;;ACxJF;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,YAAY,GAAG,gBAAgB,GAAG,aAAa;AAC/C,gCAAgC,mBAAO,CAAC,oBAAO;AAC/C,qCAAqC,mBAAO,CAAC,8BAAY;AACzD,sBAAsB,mBAAO,CAAC,wDAAyB;AACvD,kBAAkB,mBAAO,CAAC,gDAAqB;AAC/C,qCAAqC,mBAAO,CAAC,6EAAqB;AAClE,qCAAqC,mBAAO,CAAC,6EAAqB;AAClE,uCAAuC,mBAAO,CAAC,mEAAgB;AAC/D,mCAAmC,mBAAO,CAAC,2DAAY;AACvD,oCAAoC,mBAAO,CAAC,6DAAa;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,+DAA+D;AAC/D;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA,YAAY;;;;;;;;;;;ACvEC;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,sBAAsB,GAAG,mBAAmB;AAC5C,oBAAoB,mBAAO,CAAC,0CAAoB;AAChD,mBAAmB;AACnB,sBAAsB;;;;;;;;;;;ACLtB;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;ACNa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,WAAW,GAAG,WAAW;AACzB,cAAc,mBAAO,CAAC,2BAAO;AAC7B,uCAAsC,EAAE,qCAAqC,qBAAqB,EAAC;AACnG,iBAAiB,mBAAO,CAAC,uCAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,sBAAsB,GAAG,wBAAwB;AAClG;AACA;AACA,WAAW;AACX,kBAAe,kCAAkC;AACjD;AACA;AACA,CAAC","sources":["webpack://@veva/webpack/webpack/universalModuleDefinition","webpack://@veva/webpack/./src/components/dev/templates/common/footer.hbs","webpack://@veva/webpack/./src/components/dev/templates/common/header.hbs","webpack://@veva/webpack/./src/components/dev/templates/done.hbs","webpack://@veva/webpack/./src/components/dev/templates/progress.hbs","webpack://@veva/webpack/./src/components/dev/templates/start.hbs","webpack://@veva/webpack/./src/app.ts","webpack://@veva/webpack/./src/components/build/index.ts","webpack://@veva/webpack/./src/components/build/render.ts","webpack://@veva/webpack/./src/components/dev/index.ts","webpack://@veva/webpack/./src/components/dev/templates/index.ts","webpack://@veva/webpack/./src/config/index.ts","webpack://@veva/webpack/external commonjs \"@veva/core-app\"","webpack://@veva/webpack/external commonjs \"@veva/core-builder\"","webpack://@veva/webpack/external commonjs \"@veva/core-server\"","webpack://@veva/webpack/external commonjs \"@veva/utils\"","webpack://@veva/webpack/external commonjs \"@veva/utils/network\"","webpack://@veva/webpack/external commonjs \"@veva/utils/nodePackage\"","webpack://@veva/webpack/external commonjs \"@veva/utils/processConfig\"","webpack://@veva/webpack/external commonjs \"chalk\"","webpack://@veva/webpack/external commonjs \"cli-table\"","webpack://@veva/webpack/external commonjs \"fs\"","webpack://@veva/webpack/external commonjs \"handlebars\"","webpack://@veva/webpack/external commonjs \"path\"","webpack://@veva/webpack/external commonjs \"webpack\"","webpack://@veva/webpack/external commonjs \"webpack-hmr-server\"","webpack://@veva/webpack/webpack/bootstrap","webpack://@veva/webpack/webpack/runtime/define property getters","webpack://@veva/webpack/webpack/runtime/hasOwnProperty shorthand","webpack://@veva/webpack/webpack/runtime/make namespace object","webpack://@veva/webpack/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, () => {\nreturn ","export default \"Note that the development build is not optimized.\\nTo create a production build, run {{#chalk 'blue' 'bold'}}{{ packageName }}{{/chalk}} with {{#chalk 'green' 'bold'}}build{{/chalk}} options.\";","export default \"{{#nolinebreaks}}\\n{{#chalk \\\"bgBlueBright\\\" \\\"white\\\"}} {{ appName }} {{/chalk}}{{#chalk \\\"bgBlue\\\" \\\"white\\\"}} {{ appVersion }} {{/chalk}}\\n\\n{{#if (isEqual compileStatus 'success')}}\\n{{#chalk 'green'}} Compiled successfully! {{/chalk}}\\n{{/if}}\\n\\n{{#if (isEqual compileStatus 'warning')}}\\n{{#chalk 'yellow'}} Compiled with warnings! {{/chalk}}\\n{{/if}}\\n\\n{{#if (isEqual compileStatus 'failed')}}\\n{{#chalk 'red' 'bold'}} Failed to compile! {{/chalk}}\\n{{/if}}\\n\\n{{/nolinebreaks}}\\n{{!-- Compiled successfully! --}}\\n{{!-- Failed to compile. --}}\\n\\n  🚀 Node: {{ nodeVersion }} \\n  📦 Webpack: {{ webpackVersion }}\\n  🔥 HMR: {{#if hot}}Enable{{else}}{{#chalk 'red' 'bold'}}Disable{{/chalk}}{{/if}}\\n\";","export default \"═══════════════════════════════════════════════════════════════════\\n{{> header }}\\n\\n{{#if serverReady}}\\n  App running at:\\n  💻 Local:    {{#chalk 'blueBright'}}http://127.0.0.1:{{ port }}{{/chalk}}\\n  🌐 Network:  {{#chalk 'blueBright'}}http://{{ ip }}:{{ port }}{{/chalk}}\\n{{else}}\\n  ❌ {{#chalk 'red' 'bold'}}Server is start but not ready{{/chalk}}, first compile {{#chalk 'red' 'bold'}}is failed{{/chalk}}\\n{{/if}}\\n\\n{{> footer }}\\n\\n═══════════════════════════════════════════════════════════════════\\n\";","export default \"═══════════════════════════════════════════════════════════════════\\n{{> header }}\\n\\n  💻 Client: {{progressbar progress '#44bb97' '#2b2b2b' 35}} [{{#chalk 'grey'}}{{ progressStatus }}{{/chalk}}]\\n\\n{{> footer }}\\n\\n═══════════════════════════════════════════════════════════════════\\n\\n\";","export default \"\\nStart compilling...\\n\";","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.App = void 0;\nconst path_1 = __importDefault(require(\"path\"));\nconst core_app_1 = require(\"@veva/core-app\");\nconst processConfig_1 = require(\"@veva/utils/processConfig\");\nconst dev_1 = __importDefault(require(\"./components/dev\"));\nconst build_1 = __importDefault(require(\"./components/build\"));\nclass App extends core_app_1.BaseApp {\n    constructor(options) {\n        super();\n        this.run = async () => {\n            // 1. build config\n            const configs = (0, processConfig_1.getConfigs)();\n            const appConfig = await this.options.optionCallback({\n                isProd: configs.config.envType === 'production',\n                processCwd: configs.config.processCwd,\n                env: configs.env,\n            });\n            // Assign default config\n            // set default context\n            appConfig.context = appConfig.context ? appConfig.context : configs.config.processCwd;\n            const defaultDevConfig = {\n                port: 8000,\n                hot: true,\n                static: appConfig.output.path || path_1.default.resolve(configs.config.processCwd, 'public')\n            };\n            const devConfig = Object.assign({}, defaultDevConfig, this.options.devConfig);\n            // todo fix isTruethly\n            const { warnings = 'true' } = configs.config.argv;\n            const showWarnings = warnings === 'true';\n            // 2. run by action type\n            switch (configs.config.actionType) {\n                case 'dev':\n                    await (0, dev_1.default)({\n                        devConfig: devConfig,\n                        appConfig,\n                        showWarnings,\n                    });\n                    break;\n                case 'build':\n                    await (0, build_1.default)({\n                        appConfig,\n                        showWarnings,\n                    });\n                    break;\n                default:\n                    console.log(\"Dont detect action type\");\n                    process.exit(1);\n            }\n        };\n        this.options = options;\n    }\n}\nexports.App = App;\n;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst webpack_1 = __importDefault(require(\"webpack\"));\nconst core_builder_1 = require(\"@veva/core-builder\");\nconst render_1 = require(\"./render\");\nconst chalk_1 = __importDefault(require(\"chalk\"));\nconst core_builder_2 = require(\"@veva/core-builder\");\nconst log = (message, ...optionalParams) => {\n    const timestamp = '[' + new Date().toUTCString() + '] ';\n    console.log(timestamp, message, ...optionalParams);\n};\nconst progressbar = (progress = 0) => {\n    const length = 32;\n    let result = '';\n    for (let i = 0; i < length; i++) {\n        result += i < (length * progress / 100) ? '#' : '.';\n    }\n    return `[${result}] (${progress}%)`;\n};\nasync function default_1(options) {\n    const { appConfig } = options;\n    const compiler = (0, webpack_1.default)(appConfig);\n    const errors = [];\n    if ((0, core_builder_2.isExistPluginHMR)(compiler)) {\n        const errMsg = 'Detect HotModuleReplacementPlugin in production build';\n        errors.push(errMsg);\n        log(errMsg);\n    }\n    const builder = new core_builder_1.Build.Compiler(compiler);\n    builder.on('start', () => {\n        console.log('#########################################################################');\n        log('Start compilling...');\n    }).on('progress', (state) => {\n        log(progressbar(state.progress));\n    }).on('done', (state) => {\n        console.log('#########################################################################');\n        if (state.err) {\n            console.log(state.err);\n            process.exit(1);\n        }\n        if (state.stats.hasErrors()) {\n            console.log(chalk_1.default.red.bold('Build with error'));\n            console.log('');\n            console.log(state.stats.toString({\n                colors: true,\n                modules: false,\n                children: false,\n                chunks: false,\n                chunkModules: false,\n                stats: 'errors-only',\n            }));\n            process.exit(1);\n        }\n        (0, render_1.renderAssets)(state.stats);\n        console.log(chalk_1.default.green.bold('Build success'));\n    });\n    builder.run();\n}\nexports.default = default_1;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.formatSize = exports.renderAssets = exports.buildTable = void 0;\nconst cli_table_1 = __importDefault(require(\"cli-table\"));\nconst isJS = (val) => /\\.js$/.test(val);\nconst isCSS = (val) => /\\.css$/.test(val);\nconst buildTable = (assets, type) => {\n    const table = new cli_table_1.default({\n        head: ['', 'Size', 'File'],\n        colAligns: ['middle', 'right', 'left'],\n        colWidths: [5, 15, 50]\n    });\n    assets.forEach(file => {\n        table.push([type, (0, exports.formatSize)(file.size), file.name]);\n    });\n    return table.toString();\n};\nexports.buildTable = buildTable;\nconst renderAssets = (stats) => {\n    const json = stats.toJson({\n        hash: false,\n        modules: false,\n        chunks: false\n    });\n    const assets = json.assets\n        ? json.assets\n        : json.children.reduce((acc, child) => acc.concat(child.assets), []);\n    const jsMap = new Map();\n    const cssMap = new Map();\n    assets.forEach((asset) => {\n        const name = asset.name.split('?')[0];\n        const size = asset.size;\n        if (isJS(name)) {\n            jsMap.set(name, size);\n        }\n        if (isCSS(name)) {\n            cssMap.set(name, size);\n        }\n    });\n    if (cssMap.size) {\n        const cssAssets = [...cssMap]\n            .map(([name, size]) => ({ name, size }))\n            .sort((a, b) => b.size - a.size);\n        console.log((0, exports.buildTable)(cssAssets, 'css'));\n    }\n    if (jsMap.size) {\n        const jsAssets = [...jsMap]\n            .map(([name, size]) => ({ name, size }))\n            .sort((a, b) => b.size - a.size);\n        console.log((0, exports.buildTable)(jsAssets, 'js'));\n    }\n};\nexports.renderAssets = renderAssets;\nconst formatSize = (size) => {\n    return (size / 1024).toFixed(2) + ' KiB';\n};\nexports.formatSize = formatSize;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst webpack_hmr_server_1 = require(\"webpack-hmr-server\");\nconst config_1 = require(\"../../config\");\nconst webpack_1 = __importDefault(require(\"webpack\"));\nconst templates = __importStar(require(\"./templates\"));\nconst chalk_1 = __importDefault(require(\"chalk\"));\nconst fs = __importStar(require(\"fs\"));\nconst core_builder_1 = require(\"@veva/core-builder\");\nconst core_builder_2 = require(\"@veva/core-builder\");\nconst core_server_1 = require(\"@veva/core-server\");\nconst utils_1 = require(\"@veva/utils\");\nconst isFile = async (file) => new Promise(resolve => {\n    fs.access(file, fs.constants.F_OK, (err) => {\n        resolve(!err);\n    });\n});\nasync function default_1(options) {\n    const { devConfig, appConfig } = options;\n    // 1. start server\n    const server = await (0, core_server_1.createServer)(devConfig.port);\n    const hotServer = (0, webpack_hmr_server_1.createHotServer)(server.server);\n    // 2. register middlewares\n    if (Array.isArray(devConfig.static)) {\n        devConfig.static.forEach(root => {\n            server.static(root);\n        });\n    }\n    else {\n        server.static(devConfig.static);\n    }\n    // 3. create compiler and apply plugins\n    const compiler = (0, webpack_1.default)(appConfig);\n    if (devConfig.hot) {\n        (0, core_builder_1.applyPluginHMR)(compiler);\n        (0, core_builder_1.applyNoEmitOnErrorsPlugin)(compiler);\n        (0, core_builder_1.applyAdditionalEntries)(compiler, [\"webpack-hmr-server/client.legacy.js\", \"@veva/core-hmr-client\"]);\n    }\n    // 4. create builder and prcessing steps\n    const builder = new core_builder_2.Watch.Compiler(compiler);\n    builder\n        .on('start', (state) => {\n        utils_1.terminal.clear();\n        console.log(templates.start());\n    })\n        .on('progress', (state) => {\n        utils_1.terminal.clear();\n        console.log(templates.progress({\n            packageName: config_1.packageName,\n            packageVersion: config_1.packageVersion,\n            progress: state.progress,\n            progressStatus: state.status,\n            hot: devConfig.hot,\n        }));\n    })\n        .on('done', async (state) => {\n        utils_1.terminal.clear();\n        if (state.err) {\n            console.log(state.err);\n            process.exit(1);\n        }\n        let compileStatus = 'success';\n        if (state.stats.hasErrors()) {\n            compileStatus = 'failed';\n        }\n        else if (state.stats.hasWarnings()) {\n            compileStatus = 'warning';\n        }\n        const statJson = state.stats.toJson({\n            cached: true,\n            // children: true,\n            // modules: true,\n            timings: true,\n            hash: true,\n            colors: true,\n            modules: false,\n            children: false,\n            chunks: false,\n            chunkModules: false\n        });\n        if (compileStatus !== 'failed') {\n            server.static(statJson.outputPath); // default static webpack\n            server.setReady(true);\n        }\n        const statsData = (0, webpack_hmr_server_1.statsToData)(state.stats);\n        if (statsData.warnings && options.showWarnings) {\n            for (let i = 0; i < statsData.warnings.length; i++) {\n                const warning = statsData.warnings[i];\n                let file = warning.moduleName || warning.file ? warning._name_ : '';\n                file = file && warning.loc ? `${file}:${parseInt(warning.loc)}` : file;\n                let title = `🟡 ${chalk_1.default.yellow.bold('Warning')}`;\n                title += file ? ` in ${file}` : ':';\n                console.log(title);\n                console.log(warning.message);\n                console.log('');\n            }\n        }\n        if (statsData.errors) {\n            for (let i = 0; i < statsData.errors.length; i++) {\n                const error = statsData.errors[i];\n                let file = error.moduleName || error.file ? error._name_ : '';\n                file = file && error.loc ? `${file}:${parseInt(error.loc)}` : file;\n                let title = `❌ ${chalk_1.default.red.bold('ERROR')}`;\n                title += file ? ` in ${file}` : ':';\n                console.log(title);\n                console.log(error.message);\n                console.log('');\n            }\n        }\n        console.log(templates.done({\n            packageName: config_1.packageName,\n            packageVersion: config_1.packageVersion,\n            hot: devConfig.hot,\n            serverReady: server.isReady(),\n            port: devConfig.port,\n            compileStatus\n        }));\n        // Hot module replacement\n        hotServer.reloadModules({ client: state.stats });\n    });\n    // start wathc\n    builder.watch({\n        aggregateTimeout: 10,\n        poll: 10,\n    });\n}\nexports.default = default_1;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.done = exports.progress = exports.start = void 0;\nconst chalk_1 = __importDefault(require(\"chalk\"));\nconst handlebars_1 = __importDefault(require(\"handlebars\"));\nconst nodePackage_1 = require(\"@veva/utils/nodePackage\");\nconst network_1 = require(\"@veva/utils/network\");\nconst header_hbs_1 = __importDefault(require(\"./common/header.hbs\"));\nconst footer_hbs_1 = __importDefault(require(\"./common/footer.hbs\"));\nconst progress_hbs_1 = __importDefault(require(\"./progress.hbs\"));\nconst done_hbs_1 = __importDefault(require(\"./done.hbs\"));\nconst start_hbs_1 = __importDefault(require(\"./start.hbs\"));\n//---------------------------------------------------------//\nhandlebars_1.default.registerHelper('chalk', function () {\n    const args = Array.prototype.slice.apply(arguments);\n    const options = args.pop();\n    const chalkFn = args.reduce((result, i) => {\n        return result[i];\n    }, chalk_1.default);\n    return chalkFn(options.fn(this));\n});\n//---------------------------------------------------------//\n// color progressbar\nhandlebars_1.default.registerHelper('progressbar', function (progress = 0, succes = '#44bb97', fill = \"#CCCC\", length = 50) {\n    let result = '';\n    for (let i = 0; i < length; i++) {\n        result += i < (length * progress / 100) ? chalk_1.default.bgHex('#44bb97')(' ') : chalk_1.default.bgHex(fill)(' ');\n    }\n    return result;\n});\nhandlebars_1.default.registerHelper('nolinebreaks', function (options) {\n    return options.fn(this).replace(/[\\r\\n]+/gm, \"\");\n});\nhandlebars_1.default.registerHelper('isEqual', (value1, value2, options) => {\n    return value1 === value2;\n});\n//---------------------------------------------------------//\nhandlebars_1.default.registerPartial(\"header\", header_hbs_1.default);\nhandlebars_1.default.registerPartial(\"footer\", footer_hbs_1.default);\n//---------------------------------------------------------//\nconst start = () => {\n    return handlebars_1.default.compile(start_hbs_1.default)({});\n};\nexports.start = start;\nconst progress = (options) => {\n    return handlebars_1.default.compile(progress_hbs_1.default)({\n        ...{\n            appName: (0, nodePackage_1.getPackageJson)(process.cwd()).name,\n            appVersion: (0, nodePackage_1.getPackageJson)(process.cwd()).version,\n            nodeVersion: process.versions.node,\n            webpackVersion: (0, nodePackage_1.getPackageJson)('webpack').version,\n        },\n        ...options\n    });\n};\nexports.progress = progress;\nconst done = (options) => {\n    return handlebars_1.default.compile(done_hbs_1.default)({\n        ...{\n            appName: (0, nodePackage_1.getPackageJson)(process.cwd()).name,\n            appVersion: (0, nodePackage_1.getPackageJson)(process.cwd()).version,\n            nodeVersion: process.versions.node,\n            webpackVersion: (0, nodePackage_1.getPackageJson)('webpack').version,\n            ip: (0, network_1.getIp)(),\n        },\n        ...options\n    });\n};\nexports.done = done;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.packageVersion = exports.packageName = void 0;\nconst packageJson = require('../../package.json');\nexports.packageName = packageJson.name;\nexports.packageVersion = packageJson.version;\n","module.exports = require(\"@veva/core-app\");","module.exports = require(\"@veva/core-builder\");","module.exports = require(\"@veva/core-server\");","module.exports = require(\"@veva/utils\");","module.exports = require(\"@veva/utils/network\");","module.exports = require(\"@veva/utils/nodePackage\");","module.exports = require(\"@veva/utils/processConfig\");","module.exports = require(\"chalk\");","module.exports = require(\"cli-table\");","module.exports = require(\"fs\");","module.exports = require(\"handlebars\");","module.exports = require(\"path\");","module.exports = require(\"webpack\");","module.exports = require(\"webpack-hmr-server\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cli = exports.App = void 0;\nconst app_1 = require(\"./app\");\nObject.defineProperty(exports, \"App\", { enumerable: true, get: function () { return app_1.App; } });\nconst config_1 = require(\"./config\");\n// cli - methot will exec in @veva/core-app after config build\n// props unknown, for validation instance\nconst cli = async (config) => {\n    if (config instanceof app_1.App) {\n        try {\n            await config.run();\n            return;\n        }\n        catch (error) {\n            console.log(\"Error:\", (error === null || error === void 0 ? void 0 : error.message) || 'unknown');\n        }\n    }\n    console.log(`export default must be config ${config_1.packageName} v${config_1.packageVersion}`);\n    process.exit(1);\n};\nexports.cli = cli;\nexports.default = (optionCallback, devConfig = {}) => new app_1.App({\n    optionCallback,\n    devConfig,\n});\n"],"names":[],"sourceRoot":""}